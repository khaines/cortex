image: src.ent.ea.com:8443/cloudeng/cloud-build-env:1.9

stages:
  - build
  
build:
  stage: build
  tags:
    - docker
    - cloud
  only: 
    - cloud-master
    - tags
  script:
    - apt-get install -y time
    - go get -u github.com/golang/dep/cmd/dep
    - mkdir -p $GOPATH/src/github.com/weaveworks
    - cp -R $PWD $GOPATH/src/github.com/weaveworks
    - cd $GOPATH/src/github.com/weaveworks/cortex
    - make BUILD_IN_CONTAINER=true TTY=-i IMAGE_PREFIX=docker-ops-intel.darkside.ea.com/cortex-
    - docker login docker-ops-intel.darkside.ea.com -u $DOCKER_OPSINTEL_USERNAME -p $DOCKER_OPSINTEL_PASSWORD
    - IMAGE_PREFIX=docker-ops-intel.darkside.ea.com/cortex- ./tools/push-images 
    
    